swagger: '2.0'
info:
  version: '0.1.1'
  title: AMT
  description: Gamification App
host: localhost:8080
basePath: /api
schemes:
  - http
paths:
  /register:
    post:
      summary: "Register an application"
      parameters:
        - $ref: '#/parameters/Token'
        - name: body
          in: body
          description: "Required informations"
          required: true
          schema:
            $ref: "#/definitions/ApplicationDTO"
      responses:
        201:
          description: "Successfully done"
        409:
          description: "Name already taken"

  /users:
    get:
      summary: "List all users linked to current application"
      description: "List all users linked to current application"
      responses:
        200:
          description: "Successfully done"
          schema:
            type: array
            items:
              $ref: "#/definitions/UserDTO"
  /users/{id}:
    get:
      summary: "Fetch specific user"
      parameters:
        - $ref: '#/parameters/Token'
        - name: id
          in: path
          description: "User ID"
          required: true
          type: string
      responses:
        200:
          description: "Successfully done"
          schema:
            $ref: "#/definitions/UserDTO"
        404:
          description: "No such user"

  /events:
    post:
      summary: "Create an event"
      description: "Create event triggered by user action for a given application"
      parameters:
        - $ref: '#/parameters/Token'
        - name: body
          in: body
          description: "Required informations"
          required: true
          schema:
            $ref: "#/definitions/EventDTO"
      responses:
        201:
          description: "Successfully done"

  /badges:
    get:
      summary: "List all badges linked to current application"
      parameters:
        - $ref: '#/parameters/Token'
      responses:
        200:
          description: "Successfully"
          schema:
            type: array
            items:
              $ref: "#/definitions/BadgeDTO"
    post:
      summary: "Create new badge"
      parameters:
        - $ref: '#/parameters/Token'
        - name: body
          in: body
          description: "Required informations"
          required: true
          schema:
            $ref: "#/definitions/BadgeDTO"
      responses:
        201:
          description: "Successfully done"
          headers:
            Location:
              description: "URI of newly created object"
              type: string
        409:
          description: "Badge already exists"

    delete:
      summary: "Deletes specific badge"
      parameters:
        - $ref: '#/parameters/Token'
        - name: name
          in: path
          description: "Badge name"
          required: true
          type: string
      responses:
        200:
          description: "Successfully done"
        404:
          description: "No such badge"

  /pointScales:
    get:
      summary: "List point scales linked to current application"
      parameters:
        - $ref: '#/parameters/Token'
      responses:
        200:
          description: "Successfully done"
          schema:
            type: array
            items:
              $ref: "#/definitions/PointScaleDTO"
    post:
      summary: "Create point scale"
      parameters:
        - $ref: '#/parameters/Token'
        - name: body
          in: body
          description: "Required informations"
          required: true
          schema:
            $ref: "#/definitions/PointScaleDTO"
      responses:
        201:
          description: "Successfully done"
          headers:
            Location:
              description: "URI of newly created object"
              type: string
        409:
          description: "Point scale already existing"
  /pointScales/{name}:
    get:
      summary: "Fetch specific point scale"
      parameters:
        - $ref: '#/parameters/Token'
        - name: name
          in: path
          description: "Point scale name"
          required: true
          type: string
      responses:
        200:
          description: "Successfully done"
          schema:
            type: array
            items:
              $ref: "#/definitions/PointScaleDTO"
        404:
          description: "No such point scale"
    post:
      summary: "Update specific point scale"
      parameters:
        - $ref: '#/parameters/Token'
        - name: name
          in: path
          description: "Point scale name"
          required: true
          type: string
        - name: body
          in: body
          description: "Required informations"
          required: true
          schema:
            $ref: "#/definitions/PointScaleDTO"
      responses:
        200:
          description: "Successfully done"
        404:
          description: "No such point scale"
        409:
          description: "Point scale already exists"
    delete:
      summary: "Deletes specific point scale"
      parameters:
        - $ref: '#/parameters/Token'
        - name: name
          in: path
          description: "Point scale name"
          required: true
          type: string
      responses:
        200:
          description: "Successfully done"
        404:
          description: "No such point scale"

  /rules/:
    get:
      summary: "List events rules linked to current application"
      parameters:
        - $ref: '#/parameters/Token'
      responses:
        200:
          description: "Successfully done"
          schema:
            type: array
            items:
              $ref: "#/definitions/RuleDTO"
    post:
      summary: "Create a new event rule"
      parameters:
        - $ref: '#/parameters/Token'
        - name: body
          in: body
          description: "Required informations"
          required: true
          schema:
            $ref: "#/definitions/RuleDTO"
      responses:
        201:
          description: "Successfully done"
          headers:
            Location:
              description: "URI of newly created object"
              type: string
        404:
          description: "No such event rule"
        409:
          description: "Event rule already exists"
  /rules/{name}:
    get:
      summary: "Fetch specific event rule"
      parameters:
        - $ref: '#/parameters/Token'
        - name: name
          in: path
          description: "Event rule name"
          required: true
          type: string
      responses:
        200:
          description: "Successfully done"
          schema:
            $ref: "#/definitions/RuleDTO"
        404:
          description: "No such event rule"
    post:
      summary: "Update specific event rule"
      parameters:
        - $ref: '#/parameters/Token'
        - name: name
          in: path
          description: "Event rule name"
          required: true
          type: string
        - name: body
          in: body
          description: "URL of the modified event rule"
          required: true
          schema:
            $ref: "#/definitions/RuleDTO"
      responses:
        200:
          description: "Successfully done"
        404:
          description: "No such event rule"
        409:
          description: "Event rule already exists"
    delete:
      summary: "Delete specific event rule"
      parameters:
        - $ref: '#/parameters/Token'
        - name: name
          in: path
          description: "Event rule name"
          required: true
          type: string
      responses:
        200:
          description: "Successfully done"
        404:
          description: "No such event rule"

parameters:
  Token:
    description: "Token Auth"
    name: "X-Gamification-Token"
    in: header
    required: true
    type: string

responses:
  UnauthorizedError:
    description: Authentication information is missing or invalid
    headers:
      auth:
        type: string

definitions:
  UserDTO:
    description: "An user doing various actions in an application"
    type: object
    properties:
      username:
        type: string
        description: "The username of the user"
      password:
        type: string
        description: "Username password"

  ApplicationDTO:
    description: "The info of a gamified application"
    type: object
    properties:
      id:
        type: integer
        description: "Application ID"
      name:
        type: string
        description: "The unique name of the gamified application"
      token:
        type: string
        description: "The token of the gamified application"

  PointAwardDTO:
    description: "How many points an user has on a given point scale"
    type: object
    properties:
      pointAwardId:
        type: integer
        description: "Point Award ID"
      points:
        type: number
        description: "How many points are on the point scale"

  PointScaleDTO:
    description: "A point scale in an application"
    type: object
    properties:
      id:
        type: integer
        description: "Point Scale ID"
      name:
        type: string
        description: "The name of the point scale"

  EventDTO:
    description: "An event created when an user does something on the application"
    type: object
    properties:
      id:
        type: integer
        description: "Event ID"
      type:
        type: string
        description: "The type of the event"
      hashMap:
        type: object
        additionalProperties:
          properties:
            key:
              type: string
              description: "Cl√©"
            value:
              type: string
              description: "Valeur"

  BadgeDTO:
    description: "A badge in an application"
    type: object
    properties:
      id:
        type: integer
        description: "Badge ID"
      name:
        type: string
        description: "The name of the badge"

  RuleDTO:
    description: "Rule"
    type: object
    properties:
      id:
        type: integer
        description: "Rule ID"
      name:
        type: string
        description: "Rule name"
      threshold:
        type: integer
        description: "Treshold"